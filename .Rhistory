position = position, inherit.aes = inherit.aes,
show.legend = show.legend,
params = list(
chr_color = color_chr, chr_size = size_chr,
tel_color = color_tel, tel_shape = shape_tel, tel_size = size_tel,
na.rm = na.rm, ...
)
)
}
GeomTelPlot <- ggproto("GeomTelPlot", Geom,
required_aes = c("x", "y", "yend"),
default_aes = aes(),
draw_panel = function(data, panel_scales, coord, chr_color = "magenta",
chr_size = 6, tel_color = "black",
tel_shape = 16, tel_size = 3) {
# Transform coordinates
coords <- coord$transform(data, panel_scales)
# Chromosome segments
segments <- grid::segmentsGrob(
x0 = coords$x, y0 = coords$y,
x1 = coords$x, y1 = coords$yend,
gp = grid::gpar(col = chr_color, lwd = chr_size)
)
# Telomere points (start and end)
start_points <- grid::pointsGrob(
x = coords$x, y = coords$y,
pch = tel_shape,
gp = grid::gpar(col = tel_color, cex = tel_size / 2)
)
end_points <- grid::pointsGrob(
x = coords$x, y = coords$yend,
pch = tel_shape,
gp = grid::gpar(col = tel_color, cex = tel_size / 2)
)
# Combine graphical objects
grid::gList(segments, start_points, end_points)
}
)
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot()
geom_telplot <- function(
mapping = NULL, data = NULL, stat = "identity", position = "identity",
color_chr = "#F8766D", size_chr = 6,
color_tel = "black", shape_tel = 16, size_tel = 3,
..., na.rm = FALSE, show.legend = NA, inherit.aes = TRUE
) {
layer(
geom = GeomTelPlot, mapping = mapping, data = data, stat = stat,
position = position, inherit.aes = inherit.aes,
show.legend = show.legend,
params = list(
chr_color = color_chr, chr_size = size_chr,
tel_color = color_tel, tel_shape = shape_tel, tel_size = size_tel,
na.rm = na.rm, ...
)
)
}
GeomTelPlot <- ggproto("GeomTelPlot", Geom,
required_aes = c("x", "y", "yend"),
default_aes = aes(),
draw_panel = function(data, panel_scales, coord, chr_color = "#F8766D",
chr_size = 6, tel_color = "black",
tel_shape = 16, tel_size = 3) {
# Transform coordinates
coords <- coord$transform(data, panel_scales)
# Chromosome segments
segments <- grid::segmentsGrob(
x0 = coords$x, y0 = coords$y,
x1 = coords$x, y1 = coords$yend,
gp = grid::gpar(col = chr_color, lwd = chr_size)
)
# Telomere points (start and end)
start_points <- grid::pointsGrob(
x = coords$x, y = coords$y,
pch = tel_shape,
gp = grid::gpar(col = tel_color, cex = tel_size / 2)
)
end_points <- grid::pointsGrob(
x = coords$x, y = coords$yend,
pch = tel_shape,
gp = grid::gpar(col = tel_color, cex = tel_size / 2)
)
# Combine graphical objects
grid::gList(segments, start_points, end_points)
}
)
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot()
# Initialize ggnom
ggnom <- function(data, ...) {
structure(list(data = data, mapping = NULL, ...), class = "ggnom")
}
# Add a layer to ggnom objects
`+.ggnom` <- function(ggnom_obj, layer) {
if (!inherits(layer, "gg")) stop("You can only add ggplot2 layers.")
ggplot(data = ggnom_obj$data) + layer
}
# Define geom_telplot
geom_telplot <- function(chr_color = "dodgerblue2", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(genome_table) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Define geom_telplot as a custom layer
geom_telplot <- function(chr_color = "dodgerblue2", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
layer <- list(
geom_segment(aes(x = Chromosome, xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
structure(layer, class = "gg")
}
ggnom(genome_table) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Initialize ggnom
ggnom <- function(data, ...) {
structure(list(data = data, mapping = NULL, ...), class = "ggnom")
}
# Add a layer to ggnom objects
`+.ggnom` <- function(ggnom_obj, layer) {
if (!inherits(layer, "gg")) stop("You can only add ggplot2 layers.")
ggplot(data = ggnom_obj$data) + layer
}
# Define geom_telplot as a custom layer
geom_telplot <- function(chr_color = "dodgerblue2", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
layer <- list(
geom_segment(aes(x = Chromosome, xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
structure(layer, class = "gg")
}
ggnom(genome_table) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
ggnom(test_genome) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
rm(+.ggnom)
rm(`+.ggnom`)
ggnom(test_genome) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Initialize ggnom
ggnom <- function(data, ...) {
structure(list(data = data, mapping = NULL, ...), class = "ggnom")
}
# Add a layer to ggnom objects
`+.ggnom` <- function(ggnom_obj, layer) {
if (!inherits(layer, "gg")) stop("You can only add ggplot2 layers.")
ggplot(data = ggnom_obj$data) + layer
}
# Define geom_telplot as a custom layer
geom_telplot <- function(chr_color = "dodgerblue2", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
layer <- list(
geom_segment(aes(x = Chromosome, xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
structure(layer, class = "gg")
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Initialize ggnom
ggnom <- function(data, mapping = NULL, ...) {
ggplot(data = data, mapping = mapping, ...)
}
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "dodgerblue2", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "#F8766D", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, y_scale_suffix = "Mb",
legend_title = "Telomere Size (bp)",
text_size = 6, legend_pos = "bottom",
legend_size = 0.25, plot_title = NULL,
x_axis_title = NULL, y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(legend.position = legend_pos,
legend.key.size = unit(legend_size, "cm"),
plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
) +
theme_light
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
) +
theme_light()
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
) +
theme_linedraw()
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
) +
theme_bw()
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Initialize ggnom
ggnom <- function(data, mapping = NULL, ...) {
ggplot(data = data, mapping = mapping, ...)
}
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "#F8766D", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, legend_title = "Telomere Size (bp)",
text_size = 6, plot_title = NULL, x_axis_title = NULL,
y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
scale_y_continuous(labels = label_number(scale = y_scale, suffix = y_scale_suffix)),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "#F8766D", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, legend_title = "Telomere Size (bp)",
text_size = 6, plot_title = NULL, x_axis_title = NULL,
y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
plot_title = "Chromosome Ideogram",
x_axis_title = "Chromosomes"
)
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "#F8766D", chr_size = 6,
tel_color = "black", tel_shape = 16,
y_scale = 1e-6, legend_title = "Telomere Size (bp)",
text_size = 6, plot_title = NULL, x_axis_title = NULL,
y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
)
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
) +
theme(legend.position = "bottom")
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
) +
theme(legend.position = c(.2,.8), "cm")
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot(
) +
theme(legend.position = c(.8,.7), "cm")
# Define geom_telplot as a custom ggplot2 layer
geom_telplot <- function(chr_color = "#F8766D", chr_size = 6,
tel_color = "black", tel_shape = 16,
legend_title = "Telomere Size (bp)",
text_size = 6, plot_title = NULL, x_axis_title = NULL,
y_axis_title = "Chromosome Length") {
list(
geom_segment(aes(xend = Chromosome, y = begin_telo_start, yend = Length),
color = chr_color,
linewidth = chr_size,
lineend = "round"),
geom_point(aes(x = Chromosome, y = begin_telo_end, size = ifelse(begin_telo_bp == 0, NA, begin_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
geom_point(aes(x = Chromosome, y = end_telo_end, size = ifelse(end_telo_bp == 0, NA, end_telo_bp)),
shape = tel_shape,
color = tel_color,
na.rm = TRUE),
labs(y = y_axis_title, x = x_axis_title, size = legend_title, title = plot_title),
theme_classic(base_size = text_size) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))
)
}
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot()
## Load scripts for testing
# Define the folder path
folder_path <- "~/Projects/ggnomics/R/"
# Get all R scripts in the directory
scripts <- list.files(folder_path, pattern = "\\.R$", full.names = TRUE)
# Source each script
lapply(scripts, source)
## Test new structure
strep <- ggread_fasta("~/Projects/Streptanthus/Genome_Assembly/Inputs/Assemblies/S.div_Chr_Ordered.fasta")
library(data.table)
library(tidyverse)
library(scales)
library(Biostrings)
library(pbapply)
## Load scripts for testing
# Define the folder path
folder_path <- "~/Projects/ggnomics/R/"
# Get all R scripts in the directory
scripts <- list.files(folder_path, pattern = "\\.R$", full.names = TRUE)
# Source each script
lapply(scripts, source)
## Test new structure
strep <- ggread_fasta("~/Projects/Streptanthus/Genome_Assembly/Inputs/Assemblies/S.div_Chr_Ordered.fasta")
test_genome <- telomere_data(strep)
ggnom(test_genome, aes(x = Chromosome, y = begin_telo_start, yend = Length)) +
geom_telplot()
if (!requireNamespace("devtools", quietly = TRUE)) {
install.packages("devtools")
}
devtools::install_github("matthewwdavis/ggnomics")
library(ggnomics)
## Test new structure
strep <- ggread_fasta("~/Projects/Streptanthus/Genome_Assembly/Inputs/Assemblies/S.div_Chr_Ordered.fasta")
roxygen2::roxygenise()
